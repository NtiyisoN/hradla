var $__src_47_es6_47_structuresAndClasses_46_js__=function(){"use strict";var t=null,e=function(){return $traceurRuntime.createClass(function(){return t||(t=this),this.prefix="id",this.nextId=0,t},{get unique(){for(var t=this.generate();$("#"+t).length;)this.nextId++,t=this.generate();return this.nextId++,t},generate:function(){return this.prefix+this.nextId}},{})}(),n=function(){return $traceurRuntime.createClass(function(t){this.map=new Map,this.default=t},{get size(){return this.map.size},clear:function(){return this.map.clear()},forEach:function(){for(var t,e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];return(t=this.map).forEach.apply(t,$traceurRuntime.spread(e))},get:function(t){return this.map.get(t)},delete:function(t){return this.map.delete(t)},set:function(t,e){return this.map.set(t,e)},has:function(t){return this.map.has(t)},entries:function(){return this.map.entries()},keys:function(){return this.map.keys()},values:function(){return this.map.values()}},{})}();return{get Id(){return e},get MapWithDefaultValue(){return n}}}(),$__src_47_es6_47_svgObjects_46_js__=function(){"use strict";var t=$__src_47_es6_47_structuresAndClasses_46_js__,e=function(){return $traceurRuntime.createClass(function(e){this.tagName=e,this.$el=$("<"+this.tagName+">"),this.id=(new t.Id).unique},{addClass:function(t){this.$el.addClass(t)},removeClasses:function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=!0,s=!1,i=void 0;try{for(var r=void 0,o=t[Symbol.iterator]();!(n=(r=o.next()).done);n=!0){var a=r.value;this.$el.removeClass(a)}}catch(t){s=!0,i=t}finally{try{n||null==o.return||o.return()}finally{if(s)throw i}}},addAttr:function(t){this.checkIfElementExistsInDOM(),this.$el.attr(t)},getAttr:function(t){return this.checkIfElementExistsInDOM(),this.$el.attr(t)},removeAttr:function(t){this.checkIfElementExistsInDOM(),this.$el.removeAttr(t)},set id(t){this.addAttr({id:t})},get id(){return this.getAttr("id")},get:function(){return this.checkIfElementExistsInDOM(),this.$el},checkIfElementExistsInDOM:function(){var t=$("#"+this.$el.attr("id"));t.length&&(this.$el=t)}},{})}(),n=function(t){function e(t){$traceurRuntime.superConstructor(e).call(this,t)}return $traceurRuntime.createClass(e,{draggable:function(t){this.addAttr({draggable:t})}},{},t)}(e),s=(function(t){function e(t){$traceurRuntime.superConstructor(e).call(this,t)}$traceurRuntime.createClass(e,{rotatable:function(t){this.addAttr({rotatable:t})}},{},t)}(e),function(t){function e(t){$traceurRuntime.superConstructor(e).call(this,t)}return $traceurRuntime.createClass(e,{rotatable:function(t){this.addAttr({rotatable:t})}},{},t)}(n)),i=function(t){function e(t,n,s,i,r){$traceurRuntime.superConstructor(e).call(this,r),this.addAttr({x:t,y:n,width:s,height:i})}return $traceurRuntime.createClass(e,{},{},t)}(s),r=function(t){function e(t,n,s,i,r,o){$traceurRuntime.superConstructor(e).call(this,t,n,s,i,"rect"),this.addAttr({fill:r,stroke:o,"stroke-width":.5,"pointer-events":"all"})}return $traceurRuntime.createClass(e,{},{},t)}(i),o=function(t){function e(t,n,s,i,r){$traceurRuntime.superConstructor(e).call(this,t,n,s,i,"image"),this.addAttr({"xlink:href":r})}return $traceurRuntime.createClass(e,{changeUrl:function(t){this.addAttr({"xlink:href":t})}},{},t)}(i),a=function(t){function e(){$traceurRuntime.superConstructor(e).call(this,"g")}return $traceurRuntime.createClass(e,{addChild:function(t){return this.$el.append(t.$el),t}},{},t)}(s),u=function(){function t(t,e){this.x=0,this.y=0,void 0!==t&&void 0!==e&&(this.x=t,this.y=e)}return $traceurRuntime.createClass(t,{set:function(t,e){this.x=t,this.y=e},get string(){return this.x+","+this.y}},{parseFromString:function(e){var n=e.split(",");return new t(n[0],n[1])},equals:function(t,e){return t.x===e.x&&t.y===e.y}})}(),h=function(t){function e(t){$traceurRuntime.superConstructor(e).call(this,t)}return $traceurRuntime.createClass(e,{copy:function(){return new e($.extend(!0,[],this.arr))},append:function(t){$traceurRuntime.superGet(this,e.prototype,"append").call(this,t);var n=this.length;return n>=3&&(this.getItem(n-3).x===this.getItem(n-2).x&&this.getItem(n-2).x===this.getItem(n-1).x||this.getItem(n-3).y===this.getItem(n-2).y&&this.getItem(n-2).y===this.getItem(n-1).y)&&this.remove(n-2),this},get string(){for(var t="",e=0;e<this.length;++e)0!==e&&(t+=" "),t+=this.arr[e].string;return t},forEach:function(t){for(var e=0;e<this.arr.length;++e)t(this.arr[e])}},{parseFromString:function(t){for(var n=t.split(" "),s=new e,i=0;i<n.length;++i)s.append(u.parseFromString(n[i]));return s}},t)}(function(){function t(t){this.arr=void 0!==t?t:[]}return $traceurRuntime.createClass(t,{copy:function(){return t($.extend(!0,[],this.arr))},append:function(t){return this.addWithIndex(t,this.arr.length)},prepend:function(t){return this.addWithIndex(t,0)},addWithIndex:function(t,e){for(var n=this.arr.length;n>e;--n)this.arr[n]=this.arr[n-1];return this.arr[e]=t,this},get length(){return this.arr.length},getItem:function(t){return this.arr[t]},get last(){return 0!==this.length&&this.arr[this.length-1]},get first(){return 0!==this.length&&this.arr[0]},remove:function(t){for(var e=this.length,n=t;n<e;++n)this.arr[n]=this.arr[n+1];this.arr.pop()}},{})}()),c=function(t){function e(t,n,s){$traceurRuntime.superConstructor(e).call(this,"polyline"),this.addAttr({points:t.string,stroke:n,fill:"none","stroke-width":s})}return $traceurRuntime.createClass(e,{updatePoints:function(t){this.addAttr({points:t.string})}},{},t)}(e),d=function(t){function e(t,n,s){$traceurRuntime.superConstructor(e).call(this,"pattern"),this.addAttr({id:t,x:0,y:0,width:n,height:s,patternUnits:"userSpaceOnUse",viewBox:"0 0 "+n+" "+s})}return $traceurRuntime.createClass(e,{addChild:function(t){return this.$el.append(t.$el),t}},{},t)}(e);return{get Rectangle(){return r},get SvgImage(){return o},get Group(){return a},get PolylinePoint(){return u},get PolylinePoints(){return h},get PolyLine(){return c},get Pattern(){return d}}}(),$__src_47_es6_47_logic_46_js__=function(){"use strict";var t=function(){function t(){}return $traceurRuntime.createClass(t,{},{and:function(e,n){return t.testLogicRulesSymmetric(e,n,[[t.state.on,t.state.on,t.state.on],[t.state.on,t.state.off,t.state.off],[t.state.on,t.state.unknown,t.state.unknown],[t.state.on,t.state.oscillating,t.state.oscillating],[t.state.off,t.state.off,t.state.off],[t.state.off,t.state.unknown,t.state.off],[t.state.off,t.state.oscillating,t.state.off],[t.state.unknown,t.state.unknown,t.state.unknown],[t.state.unknown,t.state.oscillating,t.state.unknown],[t.state.oscillating,t.state.oscillating,t.state.oscillating]])},nand:function(e,n){return t.not(t.and(e,n))},nor:function(e,n){return t.not(t.or(e,n))},not:function(e){return e===t.state.on?t.state.off:e===t.state.off?t.state.on:e},or:function(e,n){return t.testLogicRulesSymmetric(e,n,[[t.state.on,t.state.on,t.state.on],[t.state.on,t.state.off,t.state.on],[t.state.on,t.state.unknown,t.state.on],[t.state.on,t.state.oscillating,t.state.on],[t.state.off,t.state.off,t.state.off],[t.state.off,t.state.unknown,t.state.unknown],[t.state.off,t.state.oscillating,t.state.oscillating],[t.state.unknown,t.state.unknown,t.state.unknown],[t.state.unknown,t.state.oscillating,t.state.unknown],[t.state.oscillating,t.state.oscillating,t.state.oscillating]])},xnor:function(e,n){return t.not(t.xor(e,n))},xor:function(e,n){return t.testLogicRulesSymmetric(e,n,[[t.state.on,t.state.on,t.state.off],[t.state.on,t.state.off,t.state.on],[t.state.on,t.state.unknown,t.state.unknown],[t.state.on,t.state.oscillating,t.state.oscillating],[t.state.off,t.state.off,t.state.off],[t.state.off,t.state.unknown,t.state.unknown],[t.state.off,t.state.oscillating,t.state.oscillating],[t.state.unknown,t.state.unknown,t.state.unknown],[t.state.unknown,t.state.oscillating,t.state.unknown],[t.state.oscillating,t.state.oscillating,t.state.oscillating]])},get state(){return{unknown:0,on:1,off:2,oscillating:3}},testLogicRulesSymmetric:function(t,e,n){for(var s=0;s<n.length;s++)if(n[s][0]===t&&n[s][1]===e||n[s][0]===e&&n[s][1]===t)return n[s][2]}})}();return{get default(){return t}}}(),$__src_47_es6_47_editorElements_46_js__=function(){"use strict";var t=$__src_47_es6_47_svgObjects_46_js__,e=$__src_47_es6_47_structuresAndClasses_46_js__,n=$__src_47_es6_47_logic_46_js__.default,s={on:"stateOn",off:"stateOff",unknown:"stateUnknown",oscillating:"stateOscillating"},i=function(){return $traceurRuntime.createClass(function(t){void 0!==t&&(this.name=t.replace(/^[ ]*([^(]+).*/,"$1"),this.args=t.replace(/^[^(]+\((.*)\)/,"$1").split(" "))},{setName:function(t){this.name=t},setArguments:function(t){this.args=t},get:function(){return this.name+"("+this.args.join(" ")+")"}},{})}(),r=function(){return $traceurRuntime.createClass(function(t){if(this.items=[],void 0!==t)for(var e=t.split(")"),n=0;n<e.length;n++)e[n]&&this.items.push(new i(e[n]+")"))},{getIndex:function(t){for(var e=0;e<this.items.length;e++)if(t===this.items[e].name)return e;return-1},getTranslate:function(){var t=this.getArguments(this.getIndex("translate"));return{x:t[0],y:t[1]}},getRotate:function(){var t=this.getArguments(this.getIndex("rotate"));return{deg:t[0],centreX:t[1],centreY:t[2]}},setTranslate:function(t,e){this.setParameter("translate",[t,e])},setRotate:function(t,e,n){this.setParameter("rotate",[t,e,n])},rotateRight:function(t,e){if(-1===this.getIndex("rotate"))this.setRotate(90,t,e);else{var n=(parseInt(this.getRotate().deg)+90)%360;if(180===n){var s=t;t=e,e=s}this.setRotate(n,t,e)}},get:function(){for(var t="",e=0;e<this.items.length;e++)0!==e&&(t+=" "),t+=this.items[e].get();return t},getArguments:function(t){return this.items[t].args},setParameter:function(t,e){var n=this.getIndex(t);-1===n&&(n=this.items.length,this.items[n]=new i,this.items[n].setName(t)),this.items[n].setArguments(e)}},{})}(),o=function(){return $traceurRuntime.createClass(function(t){t||console.error("Parent SVG element has not been defined."),this.parentSVG=t,this.svgObj=void 0},{onMouseDown:function(){},onMouseUp:function(){},onMouseMove:function(){},get exportData(){console.error("'json' getter has not been defined for this element",this)}},{})}(),a=function(e){function i(e,r,o,a){$traceurRuntime.superConstructor(i).call(this,e),this.gridSize=r,this.connectorSize=r,this.connectorOffset=this.connectorSize/2,this.svgObj=new t.Rectangle(o*this.gridSize-this.connectorOffset,a*this.gridSize-this.connectorOffset,this.connectorSize,this.connectorSize,"none","black"),this.svgObj.$el.addClass("connector"),this.stateAttr=!1,this.isInputConnector=!1,this.stateAttr=n.state.unknown,this.svgObj.addClass(s.unknown),this.wireIds=new Set}return $traceurRuntime.createClass(i,{addWireId:function(t){this.wireIds.add(t)},removeWireId:function(t){this.wireIds.delete(t)},removeWireIdAndUpdate:function(t){this.removeWireId(t)},setState:function(t,e){switch(this.svgObj.removeClasses(s.on,s.off,s.unknown,s.oscillating),t){case n.state.unknown:this.svgObj.addClass(s.unknown);break;case n.state.on:this.svgObj.addClass(s.on);break;case n.state.off:this.svgObj.addClass(s.off);break;case n.state.oscillating:this.svgObj.addClass(s.oscillating)}this.stateAttr=t},get state(){return this.stateAttr},get:function(){return this.svgObj},onMouseUp:function(){this.parentSVG.wireCreationHelper(this.svgObj.id)}},{},e)}(o),u=function(t){function e(t,n,s,i){$traceurRuntime.superConstructor(e).call(this,t,n,s,i),this.isInputConnector=!0}return $traceurRuntime.createClass(e,{setState:function(t,n){var s=this.parentSVG.loopGuard(n,this.svgObj.id,t);$traceurRuntime.superGet(this,e.prototype,"setState").call(this,s.state,n),!1===s.stopPropagation&&this.parentSVG.getBoxByConnectorId(this.svgObj.id).refreshState(n)},removeWireIdAndUpdate:function(t){$traceurRuntime.superGet(this,e.prototype,"removeWireIdAndUpdate").call(this,t),this.setState(n.state.unknown,this.parentSVG.getNewPropagationId())},get state(){return $traceurRuntime.superGet(this,e.prototype,"state")}},{},t)}(a),h=function(t){function e(t,n,s,i){$traceurRuntime.superConstructor(e).call(this,t,n,s,i),this.isOutput=!0}return $traceurRuntime.createClass(e,{setState:function(t,n){var s=this,i=this.parentSVG.loopGuard(n,this.svgObj.id,t);$traceurRuntime.superGet(this,e.prototype,"setState").call(this,i.state,n),!1===i.stopPropagation&&this.wireIds.forEach(function(e){s.parentSVG.getWireById(e).setState(t,n)})},get state(){return $traceurRuntime.superGet(this,e.prototype,"state")}},{},t)}(a),c=function(e){function n(e,s,i,r,o){$traceurRuntime.superConstructor(n).call(this,e),this.name=s,this.category=i,this.gridSize=this.parentSVG.gridSize,this.url="img/"+this.category+"/"+this.name+".svg",this.inputs=[],this.outputs=[],this.svgObj=new t.Group,this.width=r*this.gridSize,this.height=o*this.gridSize,this.gridWidth=r,this.gridHeight=o;var a=new t.Rectangle(0,0,this.width,this.height,"none","none");a.$el.addClass("rect"),this.svgObj.addChild(a),this.image=new t.SvgImage(0,0,this.width,this.height,this.url),this.svgObj.addChild(this.image),this.svgObj.draggable(!0),this.svgObj.rotatable(!0),this.svgObj.addAttr({type:i}),this.svgObj.$el.addClass("box"),this.svgObj.$el.addClass(i),this.generateBlockNodes()}return $traceurRuntime.createClass(n,{get exportData(){return{name:this.name,id:this.svgObj.id,category:this.category,transform:this.getTransform()}},generateBlockNodes:function(){for(var t=void 0!==arguments[0]?arguments[0]:0,e=void 0!==arguments[1]?arguments[1]:0,n=void 0!==arguments[2]?arguments[2]:0,s=void 0!==arguments[3]?arguments[3]:0,i=[],r=4;r<arguments.length;r++)i[r-4]=arguments[r];this.blockedNodes=new Set;for(var o=s;o<=this.gridWidth-e;o++)for(var a=t;a<=this.gridHeight-n;a++)this.blockedNodes.add({x:o,y:a});var u=!0,h=!1,c=void 0;try{for(var d=void 0,l=i[Symbol.iterator]();!(u=(d=l.next()).done);u=!0){var f=d.value;this.blockedNodes.add(f)}}catch(t){h=!0,c=t}finally{try{u||null==l.return||l.return()}finally{if(h)throw c}}},refreshState:function(){console.warn("Calling the virtual function refreshState has no effect.")},changeImage:function(t){t=void 0===t||""===t?"":"-"+t,this.url="img/"+this.category+"/"+this.name+t+".svg",this.image.changeUrl(this.url)},get:function(){return this.svgObj.get()},removeBlockedNode:function(t,e){var n=!0,s=!1,i=void 0;try{for(var r=void 0,o=this.blockedNodes[Symbol.iterator]();!(n=(r=o.next()).done);n=!0){var a=r.value;if(a.x===t&&a.y===e){this.blockedNodes.delete(a);break}}}catch(t){s=!0,i=t}finally{try{n||null==o.return||o.return()}finally{if(s)throw i}}},rotateBlockedNodesRight:function(){var t=this;if(void 0!==this.rotation&&4!==this.rotation||(this.rotation=0),this.rotation++,1===this.rotation||3===this.rotation){var e=new Set;this.blockedNodes.forEach(function(n){e.add({x:Math.abs(n.y-t.gridHeight),y:n.x})}),this.blockedNodes=e}else if(2===this.rotation||4===this.rotation){var n=new Set;this.blockedNodes.forEach(function(e){n.add({x:Math.abs(e.y-t.gridWidth),y:e.x})}),this.blockedNodes=n}},addInput:function(t,e){var n=this.inputs.length;this.inputs[n]=new u(this.parentSVG,this.gridSize,t,e),this.inputs[n].svgObj.addAttr({gateid:this.svgObj.id}),this.svgObj.addChild(this.inputs[n].get()),this.removeBlockedNode(t,e)},addOutput:function(t,e){var n=this.outputs.length;this.outputs[n]=new h(this.parentSVG,this.gridSize,t,e),this.outputs[n].svgObj.addAttr({gateid:this.svgObj.id}),this.svgObj.addChild(this.outputs[n].get()),this.removeBlockedNode(t,e)},getConnectorById:function(t){for(var e=0;e<this.inputs.length;e++)if(this.inputs[e].svgObj.id===t)return this.inputs[e];for(var n=0;n<this.outputs.length;n++)if(this.outputs[n].svgObj.id===t)return this.outputs[n]},getTransform:function(){var t;return this.svgObj.$el.attr("transform")?t=new r(this.svgObj.$el.attr("transform")):((t=new r).setTranslate(0,0),this.svgObj.addAttr({transform:t.get()})),t},setTransform:function(t){this.svgObj.addAttr({transform:t.get()})},onMouseDown:function(t){this.mouseLeft=!1,1===t.which&&(this.mouseLeft=!0,this.onMouseDownLeft(t),this.parentSVG.moveToFrontById(this.svgObj.id))},onMouseDownLeft:function(t){this.mouseMoved=!1;var e=this.getTransform().getTranslate();this.offset={x:t.pageX-e.x,y:t.pageY-e.y}},onMouseMove:function(t){if(this.mouseLeft){this.mouseMoved=!0;var e=t.pageX-this.offset.x,n=t.pageY-this.offset.y,s=this.getTransform();s.setTranslate(e,n),this.setTransform(s),this.updateWires(!0)}},onMouseUp:function(t){1===t.which?this.mouseMoved?this.onDrop(t):this.onClick():2===t.which&&this.onClickMiddle()},onDrop:function(t){var e=t.pageX-this.offset.x,n=t.pageY-this.offset.y;e=this.parentSVG.snapToGrid(e),n=this.parentSVG.snapToGrid(n);var s=this.getTransform();s.setTranslate(e,n),this.setTransform(s),this.updateWires()},onClick:function(){},onClickMiddle:function(){var t=this.getTransform(),e=this.svgObj.$el[0].getBoundingClientRect(),n=Math.round(e.width/2),s=Math.round(e.height/2);n-=n%this.gridSize,s-=s%this.gridSize,t.rotateRight(n,s),this.svgObj.addAttr({transform:t.get()}),this.rotateBlockedNodesRight(),this.updateWires()},updateWires:function(){for(var t=void 0!==arguments[0]&&arguments[0],e=this,n=this.inputs.concat(this.outputs),s=0;s<n.length;++s)n[s].wireIds.forEach(function(n){var s=e.parentSVG.getWireById(n);t?s.temporaryWire():s.routeWire()})}},{},e)}(o),d=function(t){function e(t){var s=void 0!==arguments[1]&&arguments[1];$traceurRuntime.superConstructor(e).call(this,t,"input","io",7,4),this.addOutput(7,2),this.outputs[0].setState(n.state.off,this.parentSVG.getNewPropagationId()),this.isOn=s}return $traceurRuntime.createClass(e,{get exportData(){var t=$traceurRuntime.superGet(this,e.prototype,"exportData");return t.isOn=this.isOn,t},generateBlockNodes:function(){$traceurRuntime.superGet(this,e.prototype,"generateBlockNodes").call(this,0,1,1,0)},refreshState:function(){var t=this.outputs[0].state;this.outputs[0].setState(t,this.parentSVG.getNewPropagationId())},set on(t){var e=this.parentSVG.getNewPropagationId();t?(this.changeImage("on"),this.outputs[0].setState(n.state.on,e)):(this.changeImage(),this.outputs[0].setState(n.state.off,e)),this.isOn=t},get on(){return this.isOn},onClick:function(){this.on=!this.on}},{},t)}(c),l=function(t){function e(t){$traceurRuntime.superConstructor(e).call(this,t,"output","io",5,4),this.addInput(0,2)}return $traceurRuntime.createClass(e,{refreshState:function(){this.setState(this.inputs[0].state)},setState:function(t){switch(t){case n.state.on:this.changeImage("on");break;case n.state.off:this.changeImage("off");break;case n.state.unknown:this.changeImage();break;case n.state.oscillating:this.changeImage("osc")}},generateBlockNodes:function(){$traceurRuntime.superGet(this,e.prototype,"generateBlockNodes").call(this,0,0,0,1)}},{},t)}(c),f=function(t){function e(t,n){$traceurRuntime.superConstructor(e).call(this,t,n,"gate",9,4),"not"===this.name?this.addInput(0,2):(this.addInput(0,1),this.addInput(0,3),this.generateBlockNodes({x:0,y:2})),this.addOutput(9,2),this.refreshState(this.parentSVG.getNewPropagationId())}return $traceurRuntime.createClass(e,{generateBlockNodes:function(t){void 0!==t?$traceurRuntime.superGet(this,e.prototype,"generateBlockNodes").call(this,0,1,0,1,t):$traceurRuntime.superGet(this,e.prototype,"generateBlockNodes").call(this,0,1,0,1)},refreshState:function(t){switch(void 0===t&&console.error("refreshState error: propagationId cannot be undefined"),this.name){case"and":this.outputs[0].setState(n.and(this.inputs[0].state,this.inputs[1].state),t);break;case"nand":this.outputs[0].setState(n.nand(this.inputs[0].state,this.inputs[1].state),t);break;case"nor":this.outputs[0].setState(n.nor(this.inputs[0].state,this.inputs[1].state),t);break;case"not":this.outputs[0].setState(n.not(this.inputs[0].state),t);break;case"or":this.outputs[0].setState(n.or(this.inputs[0].state,this.inputs[1].state),t);break;case"xnor":this.outputs[0].setState(n.xnor(this.inputs[0].state,this.inputs[1].state),t);break;case"xor":this.outputs[0].setState(n.xor(this.inputs[0].state,this.inputs[1].state),t)}}},{},t)}(c),g=function(i){function r(t,e,i,o){$traceurRuntime.superConstructor(r).call(this,t),this.gridSize=o,this.fromId=e,this.toId=i,this.startBox=this.parentSVG.getBoxByConnectorId(e),this.endBox=this.parentSVG.getBoxByConnectorId(i),this.startConnector=this.parentSVG.getConnectorById(e),this.endConnector=this.parentSVG.getConnectorById(i),this.routeWire(),this.stateAttr=n.state.unknown,this.startConnector.isOutput?this.setState(this.startConnector.state,this.parentSVG.getNewPropagationId()):this.endConnector.isOutput?this.setState(this.endConnector.state,this.parentSVG.getNewPropagationId()):this.svgObj.addClass(s.unknown),this.svgObj.$el.addClass("wire")}return $traceurRuntime.createClass(r,{get exportData(){return{fromId:this.fromId,toId:this.toId}},setState:function(t,e){switch(this.svgObj.removeClasses(s.on,s.off,s.unknown,s.oscillating),t){case n.state.unknown:this.svgObj.addClass(s.unknown);break;case n.state.on:this.svgObj.addClass(s.on);break;case n.state.off:this.svgObj.addClass(s.off);break;case n.state.oscillating:this.svgObj.addClass(s.oscillating)}this.startConnector.isInputConnector&&this.startConnector.setState(t,e),this.endConnector.isInputConnector&&this.endConnector.setState(t,e),this.stateAttr=t},get state(){return this.stateAttr},updateWireState:function(){this.startBox.refreshState(this.parentSVG.getNewPropagationId()),this.endBox.refreshState(this.parentSVG.getNewPropagationId())},get:function(){return this.svgObj.get()},getTemporaryWirePoints:function(){var e=new t.PolylinePoints;return e.append(new t.PolylinePoint(this.wireStart.x,this.wireStart.y)),e.append(new t.PolylinePoint(this.wireEnd.x,this.wireEnd.y)),e},temporaryWire:function(){this.wireStart=this.getCoordinates(this.startConnector,!1),this.wireEnd=this.getCoordinates(this.endConnector,!1),this.setWirePath(this.getTemporaryWirePoints())},routeWire:function(){var t=void 0===arguments[0]||arguments[0];this.wireStart=this.getCoordinates(this.startConnector,t),this.wireEnd=this.getCoordinates(this.endConnector,t),this.points=this.aStar({x:this.wireStart.x/this.gridSize,y:this.wireStart.y/this.gridSize},{x:this.wireEnd.x/this.gridSize,y:this.wireEnd.y/this.gridSize}),this.setWirePath(this.points),this.updateWireState()},setWirePath:function(e){void 0!==this.svgObj?this.svgObj.updatePoints(e):this.svgObj=new t.PolyLine(e,"#8b8b8b",2),this.svgObj.removeClasses(s.on,s.off,s.unknown,s.oscillating),this.svgObj.addClass(s.unknown),this.svgObj.addAttr({fromId:this.fromId,toId:this.toId})},aStar:function(n,s){var i=new Set,o=new Set;o.add(n);var a=new Map,u=new e.MapWithDefaultValue(1/0);u.set(n,0);var h=new e.MapWithDefaultValue(1/0);h.set(n,r.manhattanDistance(n,s));var c,d=this.parentSVG.getNonRoutableNodes();c=void 0===this.svgObj?this.parentSVG.getInconvenientNodes():this.parentSVG.getInconvenientNodes(this.svgObj.id);var l,f=this;t:for(;o.size>0;)switch(l=function(){var e,n;if(o.forEach(function(t){(!e||h.get(t)<n)&&(e=t,n=h.get(e))}),t.PolylinePoint.equals(e,s))return{v:f.reconstructPath(a,e)};o.delete(e),i.add(e);for(var l=0;l<4;l++)for(var g=r.movePoint(e,l),p=0;p<50&&!r.setHasThisPoint(d,f.scalePointToGrid(g));p++)if(!i.has(g)){o.has(g).y||o.add(g);var v=1;0!==p&&(v=2);var m=u.get(e)+v;if(r.setHasThisPoint(c,f.scalePointToGrid(g))&&(m+=1),!(m>=u.get(g))){if(a.set(g,e),u.set(g,m),h.set(g,m+r.manhattanDistance(g,s)),r.setHasThisPoint(c,f.scalePointToGrid(g)))break;g=r.movePoint(g,l)}}return o.size>5e4?0:void 0}()){case 0:break t;default:if("object"===(void 0===l?"undefined":$traceurRuntime.typeof(l)))return l.v}return this.getTemporaryWirePoints()},scalePointToGrid:function(t){return{x:t.x*this.gridSize,y:t.y*this.gridSize}},reconstructPath:function(e,n){var s=new t.PolylinePoints;for(s.append(new t.PolylinePoint(n.x*this.gridSize,n.y*this.gridSize));e.has(n);)n=e.get(n),s.append(new t.PolylinePoint(n.x*this.gridSize,n.y*this.gridSize));return s},getCoordinates:function(t){var e=void 0===arguments[1]||arguments[1],n=(t.svgObj.id,t.svgObj.$el),s=n.position(),i=n.attr("width"),r=n.attr("height"),o=s.left+i/2,a=s.top+r/2;return e&&(o=this.parentSVG.snapToGrid(o),a=this.parentSVG.snapToGrid(a)),{x:o,y:a}}},{movePoint:function(t,e){switch(e){case 0:return{x:t.x,y:t.y-1};case 1:return{x:t.x+1,y:t.y};case 2:return{x:t.x,y:t.y+1};case 3:return{x:t.x-1,y:t.y}}},manhattanDistance:function(t,e){return Math.abs(t.x-e.x)+Math.abs(t.y-e.y)},setHasThisPoint:function(t,e){var n=!0,s=!1,i=void 0;try{for(var r=void 0,o=t[Symbol.iterator]();!(n=(r=o.next()).done);n=!0){var a=r.value;if(a.x===e.x&&a.y===e.y)return!0}}catch(t){s=!0,i=t}finally{try{n||null==o.return||o.return()}finally{if(s)throw i}}return!1}},i)}(o);return{get Transform(){return r},get InputConnector(){return u},get OutputConnector(){return h},get InputBox(){return d},get OutputBox(){return l},get Gate(){return f},get Wire(){return g}}}(),$__src_47_es6_47_contextMenu_46_js__=function(){"use strict";var t=function(){return $traceurRuntime.createClass(function(t,e,n,s,i){this.name=t,this.type=e,this.contextMenu=n,this.parentSVG=s,this.$el=$("<li>"),$(this.$el).text(t).attr("type",e),i&&$(this.$el).click(function(t){i(t),n.hide()})},{addClass:function(t){return this.$el.addClass(t),this},appendItem:function(t){return this.subList||(this.subList=$("<ul>"),this.$el.append(this.subList)),this.subList.append(t.jQuery),t},get jQuery(){return this.$el}},{})}(),e=function(t){function e(t,n,s){$traceurRuntime.superConstructor(e).call(this,t,t,n,s,function(e){var i={left:Math.round(n.position.x/s.gridSize)*s.gridSize,top:Math.round(n.position.y/s.gridSize)*s.gridSize};s.newGate(t,i.left,i.top)})}return $traceurRuntime.createClass(e,{},{},t)}(t),n=function(){return $traceurRuntime.createClass(function(n){var s=this;this.parentSVG=n;var i=["not","and","or","nand","nor","xor","xnor"];this.position={x:0,y:0},this.$el=$("<ul>"),this.$el.attr("id","contextMenu");for(var r=new t("New gate","",this,n),o=0;o<i.length;++o)r.appendItem(new e(i[o],this,n));this.appendItem(r),this.appendItem(new t("Input box","",this,n,function(){var t={left:s.parentSVG.snapToGrid(s.position.x),top:s.parentSVG.snapToGrid(s.position.y)};n.newInput(t.left,t.top)})),this.appendItem(new t("Output box","",this,n,function(){var t={left:s.parentSVG.snapToGrid(s.position.x),top:s.parentSVG.snapToGrid(s.position.y)};n.newOutput(t.left,t.top)})),this.appendConditionalItem("box","Remove this item",function(t){s.parentSVG.removeBox(t)}),this.appendConditionalItem("wire","Remove this wire",function(t){s.parentSVG.removeWireById(t)}),n.$svg.before(this.$el)},{appendItem:function(t){return this.$el.append(t.jQuery),t},appendConditionalItem:function(t,e,n){this.conditionalItems||(this.conditionalItems=[]),this.conditionalItems[this.conditionalItems.length]={itemClass:t,text:e,clickFunction:n}},resolveConditionalItems:function(e){for(var n=this,s=this,i=0;i<this.conditionalItems.length;++i)!function(i){e.hasClass(s.conditionalItems[i].itemClass)&&s.appendItem(new t(s.conditionalItems[i].text,"",s,s.parentSVG,function(){n.conditionalItems[i].clickFunction(e.attr("id"))})).addClass("conditional")}(i)},hideAllConditionalItems:function(){this.$el.children(".conditional").remove()},display:function(t,e,n){this.position={x:t,y:e},this.$el.css({display:"block",top:e+"px",left:t+"px"}),this.resolveConditionalItems(n)},hide:function(){this.$el.css({display:"none"}),this.hideAllConditionalItems()}},{})}();return{get default(){return n}}}(),$__src_47_es6_47_importExport_46_js__=function(){"use strict";var t=function(){function t(t){this.parentSVG=t}return $traceurRuntime.createClass(t,{get exportData(){return this.parentSVG.exportData},json:function(){var e=void 0!==arguments[0]?arguments[0]:t.style.compact;if(void 0!==arguments[1]&&arguments[1])return"data:application/json;charset=utf-8,"+encodeURIComponent(this.json(e));switch(e){case t.style.compact:return JSON.stringify(this.exportData);case t.style.pretty:return JSON.stringify(this.exportData,null,2)}}},{get style(){return{pretty:0,compact:1}}})}();return{get exportNetwork(){return t}}}(),$__src_47_es6_47_floatingMenu_46_js__=function(){"use strict";var t=$__src_47_es6_47_importExport_46_js__.exportNetwork,e=function(){return $traceurRuntime.createClass(function(t){this.$el=t?$("<"+t+">"):$("<div>")},{},{})}(),n=function(t){function e(t){$traceurRuntime.superConstructor(e).call(this),this.$el.addClass("helpWindowItem"),this.$el.html(t)}return $traceurRuntime.createClass(e,{},{},t)}(e),s=function(t){function e(){$traceurRuntime.superConstructor(e).call(this),this.$el.attr("id","help"),this.append(new n("<strong>main menu</strong>: right click")),this.append(new n("drag and drop to <strong>move elements</strong>")),this.append(new n("<strong>middle click</strong> to rotate elements")),this.append(new n("<strong>click <img src='img/gui/help.svg' class='helpicon' alt='help icon'></strong> to display documentation (in czech)"))}return $traceurRuntime.createClass(e,{append:function(t){this.$el.append(t.$el)}},{},t)}(e),i=function(t){function e(t,n,s,i){$traceurRuntime.superConstructor(e).call(this,i),this.$el.addClass("button"),this.$el.addClass(t),this.$el.append($("<img>").attr("src","img/gui/"+n+".svg").attr("alt",s).attr("title",s))}return $traceurRuntime.createClass(e,{},{},t)}(e),r=function(e){function n(e){$traceurRuntime.superConstructor(n).call(this);this.$el.attr("id","floatingMenu");var r=new i("export","export","Export this network","a");r.$el.on("click",function(){var n=new t(e),s=$("<div>").attr("id","jsonExport");s.append($("<pre>").append($("<code>").text(n.json(t.style.pretty)))),s.append($("<a>").attr({href:n.json(t.style.pretty,!0),class:"download",download:"network.json"}).append($("<img>").attr("src","img/gui/export.svg")).append(" expanded JSON")),s.append($("<a>").attr({href:n.json(t.style.compact,!0),class:"download",download:"network.min.json"}).append($("<img>").attr("src","img/gui/export.svg")).append(" compact JSON")),lity(s)}),this.append(r);var o=new i("help","help","Display help","a");o.$el.on("mouseover",function(){$("#help").addClass("visible")}).on("mouseout",function(){$("#help").removeClass("visible")}),o.$el.attr({href:"./docs/","data-lity":""}),this.append(o),e.$svg.after(this.$el),e.$svg.after((new s).$el)}return $traceurRuntime.createClass(n,{append:function(t){this.$el.append(t.$el)}},{},e)}(e);return{get default(){return r}}}(),$__src_47_es6_47_canvas_46_js__=function(){"use strict";var t=$__src_47_es6_47_svgObjects_46_js__,e=$__src_47_es6_47_editorElements_46_js__,n=$__src_47_es6_47_logic_46_js__.default,s=$__src_47_es6_47_contextMenu_46_js__.default,i=$__src_47_es6_47_floatingMenu_46_js__.default,r=function(){return $traceurRuntime.createClass(function(e,n){var r=this;this.$svg=$(e),this.gridSize=n,this.boxes=[],this.wires=[],this.$defs=$("<defs>"),this.$svg.prepend(this.$defs);var o=new t.Pattern("grid",this.gridSize,this.gridSize),a=(new t.PolylinePoints).append(new t.PolylinePoint(0,0)).append(new t.PolylinePoint(this.gridSize,0)).append(new t.PolylinePoint(this.gridSize,this.gridSize));o.addChild(new t.PolyLine(a,"#a3a4d2",2)),this.addPattern(o.get()),this.background=new t.Rectangle(0,0,"100%","100%","url(#grid)","none"),this.appendJQueryObject(this.background.get()),this.refresh(),this.contextMenu=new s(this),this.floatingMenu=new i(this);var u;this.$svg.on("mousedown",function(t){void 0!==(u=r.getRealTarget(t.target))&&u.onMouseDown(t),r.hideContextMenu(),t.preventDefault()}).on("mousemove",function(t){void 0!==u&&u.onMouseMove(t),t.preventDefault()}).on("mouseup",function(t){void 0!==u&&u.onMouseUp(t),u=void 0,t.preventDefault()}).on("contextmenu",function(t){r.displayContextMenu(t.pageX,t.pageY,r.getRealJQueryTarget(t.target)),t.preventDefault()})},{get exportData(){for(var t={gridSize:this.gridSize,boxes:[],wires:[]},e=0;e<this.boxes.length;++e)t.boxes[e]=this.boxes[e].exportData;for(var n=0;n<this.wires.length;++n)t.wires[n]=this.wires[n].exportData;return t},wireCreationHelper:function(t){this.firstConnectorId?(this.newWire(this.firstConnectorId,t),this.firstConnectorId=void 0):this.firstConnectorId=t},getNewPropagationId:function(){return this.propagationHistory=new Map,void 0===this.propId?this.propId=1:this.propId++,this.propId},loopGuard:function(t,e,s){if(t===this.propId)if(this.propagationHistory.has(e)){for(var i=this.propagationHistory.get(e),r=!1,o=0;o<i.length;++o)if(i[o]===s){r=!0;break}var a=i[i.length-1];if(i[i.length]=s,this.propagationHistory.set(e,i),r)return a!==s?{stopPropagation:!1,state:n.state.oscillating}:{stopPropagation:!0,state:s}}else this.propagationHistory.set(e,[s]);else this.propagationHistory=new Map;return{stopPropagation:!1,state:s}},newGate:function(t,n,s){return this.newBox(n,s,new e.Gate(this,t,n,s))},newInput:function(t,n){return this.newBox(t,n,new e.InputBox(this))},newOutput:function(t,n){return this.newBox(t,n,new e.OutputBox(this))},newBox:function(t,n,s){var i=this.boxes.length;if(this.boxes[i]=s,t&&n){var r=new e.Transform;r.setTranslate(t,n),this.boxes[i].svgObj.addAttr({transform:r.get()})}return this.appendElement(this.boxes[i]),this.boxes[i]},removeBox:function(t){for(var e=$("#"+t),n=-1,s=0;s<this.boxes.length;s++)if(this.boxes[s].svgObj.id===t){n=s;break}if(n>-1){for(var i=0;i<this.boxes[n].inputs.length;i++)this.removeWiresByConnectorId(this.boxes[n].inputs[i].svgObj.id);for(var r=0;r<this.boxes[n].outputs.length;r++)this.removeWiresByConnectorId(this.boxes[n].outputs[r].svgObj.id);this.boxes.splice(n,1),e.remove()}else console.error("Trying to remove an nonexisting gate. (Gate id: "+t+")")},newWire:function(t,n){if(t===n)return!1;this.fromId=t,this.toId=n;var s=this.getConnectorById(t),i=this.getConnectorById(n);s.isInputConnector&&this.removeWiresByConnectorId(t),i.isInputConnector&&this.removeWiresByConnectorId(n);var r=this.wires.length;return this.wires[r]=new e.Wire(this,t,n,this.gridSize),s.addWireId(this.wires[r].svgObj.id),i.addWireId(this.wires[r].svgObj.id),this.appendElement(this.wires[r]),this.moveToBackById(this.wires[r].svgObj.id),this.wires[r]},getWireById:function(t){for(var e=this.wires.length,n=0;n<e;n++)if(this.wires[n].svgObj.id===t)return this.wires[n];return!1},getWiresByConnectorId:function(t){return this.getConnectorById(t).wireIds},removeWireById:function(t){for(var e=0;e<this.wires.length;++e)if(this.wires[e].svgObj.id===t){var n=this.wires[e].startConnector,s=this.wires[e].endConnector;n.removeWireIdAndUpdate(t),s.removeWireIdAndUpdate(t),this.wires[e].svgObj.$el.remove(),this.wires.splice(e,1);break}},removeWiresByConnectorId:function(t){var e=this,s=this.getConnectorById(t);s.wireIds.forEach(function(s){var i=e.getWireById(s),r=e.getConnectorById(i.fromId,i);r.svgObj.id===t&&(r=e.getConnectorById(i.toId,i)),r.wireIds.delete(s),$("#"+s).remove(),r.isInputConnector&&r.setState(n.state.unknown,e.getNewPropagationId())}),s.wireIds.clear(),s.isInputConnector&&s.setState(n.state.unknown,this.getNewPropagationId())},getBoxById:function(t){for(var e=0;e<this.boxes.length;e++)if(this.boxes[e].svgObj.id===t)return this.boxes[e];return!1},getBoxByConnectorId:function(t){for(var e=0;e<this.boxes.length;e++){for(var n=0;n<this.boxes[e].inputs.length;n++)if(this.boxes[e].inputs[n].svgObj.id===t)return this.boxes[e];for(var s=0;s<this.boxes[e].outputs.length;s++)if(this.boxes[e].outputs[s].svgObj.id===t)return this.boxes[e]}return!1},getConnectorById:function(t,e){if(void 0!==e){var n=e.startBox.getConnectorById(t);return n||(n=e.endBox.getConnectorById(t)),n}for(var s=this.boxes.length,i=0;i<s;i++){var r=this.boxes[i].getConnectorById(t);if(r)return r}},getRealJQueryTarget:function(t){var e=$(t);if(!e.hasClass("connector")&&e.parents("g").length>0)for(e=e.parent();"G"!==e.prop("tagName")&&"g"!==e.prop("tagName");)e=e.parent();return e},getRealTarget:function(t){var e=$(t);if(e.hasClass("connector"))return this.getConnectorById(e.attr("id"));if(e.parents("g").length>0){for(var n=e.parent();"G"!==n.prop("tagName")&&"g"!==n.prop("tagName");)n=n.parent();return this.getBoxById(n.attr("id"))}return e.hasClass("wire")?this.getWireById(e.attr("id")):void 0},appendElement:function(t){this.appendJQueryObject(t.get())},appendJQueryObject:function(t){this.$svg.append(t),this.refresh()},addPattern:function(t){this.$defs.append(t),this.refresh()},refresh:function(){this.$svg.html(this.$svg.html()),console.log("SVG document has been reloaded.")},displayContextMenu:function(t,e,n){this.contextMenu.display(t,e,n)},hideContextMenu:function(){this.contextMenu.hide()},snapToGrid:function(t){return Math.round(t/this.gridSize)*this.gridSize},getNonRoutableNodes:function(){for(var t=new Set,e=0;e<this.boxes.length;++e){var n=$("#"+this.boxes[e].svgObj.id).children(".rect")[0],s=$(n).position();s.left=this.snapToGrid(s.left),s.top=this.snapToGrid(s.top);var i=!0,r=!1,o=void 0;try{for(var a=void 0,u=this.boxes[e].blockedNodes[Symbol.iterator]();!(i=(a=u.next()).done);i=!0){var h=a.value,c=s.left+h.x*this.gridSize,d=s.top+h.y*this.gridSize;t.add({x:c,y:d})}}catch(t){r=!0,o=t}finally{try{i||null==u.return||u.return()}finally{if(r)throw o}}}return this.refresh(),t},moveToFrontById:function(t){this.$svg.append($("#"+t))},moveToBackById:function(t){$("#"+this.background.id).after($("#"+t))},getInconvenientNodes:function(t){for(var e=this,n=new Set,s=this,i=0;i<this.wires.length;++i)!function(i){if(void 0===t||t!==s.wires[i].svgObj.id){var r;s.wires[i].points.forEach(function(t){if(void 0===r)n.add({x:t.x,y:t.y});else if(r.x===t.x)for(var s=Math.min(r.y,t.y),i=Math.max(r.y,t.y);s<=i;)n.add({x:t.x,y:s}),s+=e.gridSize;else if(r.y===t.y)for(var o=Math.min(r.x,t.x),a=Math.max(r.x,t.x);o<=a;)n.add({x:o,y:t.y}),o+=e.gridSize;else console.error("getInconvenientNodes: line between two points is neither horizontal nor vertical");r={x:t.x,y:t.y}})}}(i);return n}},{snapToGrid:function(t,e){return Math.round(t/e)*e}})}();return{get default(){return r}}}(),$__src_47_es6_47_main_46_js__=function(){"use strict";var t=$__src_47_es6_47_canvas_46_js__.default;return $(function(){new t("svg#canvas",10)}),{}}();